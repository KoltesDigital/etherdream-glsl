# etherdream-glsl

Draws an animation using [Ether Dream (laser DAC)](https://www.ether-dream.com/) which follows points generated by a fragment shader.

More precisely, a shader is used to fill two 1D textures, one for the position, and the other for the color. A single rendering thus generates a batch of points, which are then given to a backend implementation.

## Example

```glsl
#version 330

in float index;

layout(location=0) out vec2 position;
layout(location=1) out vec3 color;

uniform float base;

void main()
{
	float angle = (base + index) * .05;
	position = vec2(cos(angle), sin(angle));
	color = .5 + .5 * cos(6.2835 * (angle + vec3(0, 1, 2) / 3.));
}
```

## Build

Generate your build files using [Premake 5](https://premake.github.io/).

### Windows

The recommanded way is to install [Visual Studio 2017](https://visualstudio.microsoft.com/) (there's a free version).

Open a console in the project directory and run:

    premake5 vs2017

Open the generated _build/etherdream-glsl.sln_ and compile.

## Usage

### Outputs

While the point generation is always based on a shader, the output can be chosen between some implementations.

| Output                 | Description                                         |
| ---------------------- | --------------------------------------------------- |
| `console`              | Dumps points to stdout. Useful for quick debugging. |
| `etherdream` (default) | Connects to a DAC and sends points.                 |

### Command line arguments

| Argument         | Default    | Description                       |
| ---------------- | ---------- | --------------------------------- |
| `-output`, `-o`  | etherdream | Shows information messages.       |
| `-points`, `-p`  | 1800       | Resolution of a single rendering. |
| `-shader`, `-sc` | _Required_ | Shader file path.                 |
| `-verbose`, `-v` |            | Shows information messages.       |

Show this list by request help too:

    ./etherdream-glsl -h

Note that each output adds some specific arguments.

#### Console output

| Argument                | Default | Description                                            |
| ----------------------- | ------- | ------------------------------------------------------ |
| `-limit-points`, `-l`   | 0       | If greater than 0, limits the number of dumped points. |
| `-pause-duration`, `-d` | 0       | Pause between renderings, in seconds.                  |

#### Etherdream output

| Argument              | Default | Description                    |
| --------------------- | ------- | ------------------------------ |
| `-card-index`, `-i`   | 0       | Card index in the device list. |
| `-list-devices`, `-l` |         | Lists devices.                 |
| `-offset-x`, `-ox`    | 0       | Offsets X coordinates.         |
| `-offset-y`, `-oy`    | 0       | Offsets Y coordinates.         |
| `-scale`, `-sc`       | 1       | Scales coordinates.            |

### Shader IO

| Varying | Type   | Description                                                               |
| ------- | ------ | ------------------------------------------------------------------------- |
| `index` | flloat | The pixel coordinate in the 1D textures, in range (0, _point count_ - 1). |

| Uniform | Type  | Description                                                                 |
| ------- | ----- | --------------------------------------------------------------------------- |
| `base`  | float | The pixel coordinate offset, increases by _point count_ at every rendering. |

Note: to simulate a never-ending stream of points, use the value `base + index`.

| Location | Recommended name | Type | Descripion                          |
| -------- | ---------------- | ---- | ----------------------------------- |
| 0        | `position`       | vec2 | Point position, in range (-1, 1)^2. |
| 1        | `color`          | vec3 | Point color, in range (0, 1)^3.     |

## Dependencies

- [efsw](https://bitbucket.org/SpartanJ/efsw)
- [glew](http://glew.sourceforge.net/)

### Windows

- [etherdream-driver](https://github.com/j4cbo/etherdream-driver)
